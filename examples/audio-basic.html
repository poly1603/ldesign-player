<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ³é¢‘æ’­æ”¾å™¨ - åŸºç¡€ç¤ºä¾‹</title>
  <link rel="stylesheet" href="../src/styles/index.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
    }

    h1 {
      color: #1890ff;
    }

    .demo {
      margin: 20px 0;
    }

    button {
      padding: 8px 16px;
      margin: 4px;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      background: #fff;
      cursor: pointer;
    }

    button:hover {
      background: #f5f5f5;
    }

    input[type="range"] {
      width: 200px;
    }

    #time {
      font-family: monospace;
    }
  </style>
</head>

<body>
  <h1>ğŸµ éŸ³é¢‘æ’­æ”¾å™¨ - åŸºç¡€ç¤ºä¾‹</h1>

  <div class="demo">
    <h2>æ’­æ”¾æ§åˆ¶</h2>
    <button id="playBtn">æ’­æ”¾</button>
    <button id="pauseBtn">æš‚åœ</button>
    <button id="stopBtn">åœæ­¢</button>
    <button id="prevBtn">ä¸Šä¸€é¦–</button>
    <button id="nextBtn">ä¸‹ä¸€é¦–</button>
  </div>

  <div class="demo">
    <h2>éŸ³é‡æ§åˆ¶</h2>
    <input type="range" id="volumeSlider" min="0" max="100" value="100">
    <span id="volumeValue">100%</span>
    <button id="muteBtn">é™éŸ³</button>
  </div>

  <div class="demo">
    <h2>è¿›åº¦æ§åˆ¶</h2>
    <input type="range" id="progressSlider" min="0" max="100" value="0">
    <div id="time">00:00 / 00:00</div>
  </div>

  <div class="demo">
    <h2>æ’­æ”¾é€Ÿç‡</h2>
    <button data-rate="0.5">0.5x</button>
    <button data-rate="1">1x</button>
    <button data-rate="1.5">1.5x</button>
    <button data-rate="2">2x</button>
  </div>

  <div class="demo">
    <h2>å¾ªç¯æ¨¡å¼</h2>
    <button data-loop="none">ä¸å¾ªç¯</button>
    <button data-loop="single">å•æ›²å¾ªç¯</button>
    <button data-loop="list">åˆ—è¡¨å¾ªç¯</button>
    <button data-loop="random">éšæœºæ’­æ”¾</button>
  </div>

  <div class="demo">
    <h2>æ’­æ”¾åˆ—è¡¨</h2>
    <ul id="playlist"></ul>
  </div>

  <script type="module">
    import { createAudioPlayer } from '../src/index.ts';

    // ç¤ºä¾‹æ’­æ”¾åˆ—è¡¨
    const playlist = [
      {
        id: '1',
        title: 'ç¤ºä¾‹éŸ³é¢‘ 1',
        artist: 'è‰ºæœ¯å®¶ A',
        src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
      },
      {
        id: '2',
        title: 'ç¤ºä¾‹éŸ³é¢‘ 2',
        artist: 'è‰ºæœ¯å®¶ B',
        src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
      },
    ];

    // åˆ›å»ºæ’­æ”¾å™¨
    const player = createAudioPlayer({
      playlist,
      volume: 1,
      loopMode: 'list',
    });

    // è·å–æ’­æ”¾åˆ—è¡¨ç®¡ç†å™¨
    const playlistManager = player.getPlaylistManager();
    playlistManager.setCurrentIndex(0);

    // æ¸²æŸ“æ’­æ”¾åˆ—è¡¨
    function renderPlaylist() {
      const ul = document.getElementById('playlist');
      ul.innerHTML = '';
      const tracks = playlistManager.getAll();
      tracks.forEach((track, index) => {
        const li = document.createElement('li');
        li.textContent = `${track.title} - ${track.artist}`;
        li.style.cursor = 'pointer';
        li.style.padding = '4px';
        if (index === playlistManager.getCurrentIndex()) {
          li.style.fontWeight = 'bold';
          li.style.color = '#1890ff';
        }
        li.addEventListener('click', () => {
          playlistManager.setCurrentIndex(index);
          player.play();
        });
        ul.appendChild(li);
      });
    }

    renderPlaylist();

    // æ’­æ”¾æ§åˆ¶
    document.getElementById('playBtn').addEventListener('click', () => player.play());
    document.getElementById('pauseBtn').addEventListener('click', () => player.pause());
    document.getElementById('stopBtn').addEventListener('click', () => player.stop());
    document.getElementById('prevBtn').addEventListener('click', () => player.prev());
    document.getElementById('nextBtn').addEventListener('click', () => player.next());

    // éŸ³é‡æ§åˆ¶
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');
    volumeSlider.addEventListener('input', (e) => {
      const vol = e.target.value / 100;
      player.setVolume(vol);
      volumeValue.textContent = e.target.value + '%';
    });

    document.getElementById('muteBtn').addEventListener('click', () => {
      if (player.isMuted()) {
        player.unmute();
      } else {
        player.mute();
      }
    });

    // è¿›åº¦æ§åˆ¶
    const progressSlider = document.getElementById('progressSlider');
    progressSlider.addEventListener('input', (e) => {
      const percent = e.target.value / 100;
      const duration = player.getDuration();
      player.seek(duration * percent);
    });

    // æ›´æ–°è¿›åº¦
    player.on('timeupdate', ({ currentTime, duration }) => {
      if (!progressSlider.matches(':active')) {
        progressSlider.value = (currentTime / duration) * 100 || 0;
      }

      const formatTime = (sec) => {
        const min = Math.floor(sec / 60);
        const s = Math.floor(sec % 60);
        return `${min.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      };

      document.getElementById('time').textContent =
        `${formatTime(currentTime)} / ${formatTime(duration)}`;
    });

    // æ’­æ”¾é€Ÿç‡
    document.querySelectorAll('[data-rate]').forEach(btn => {
      btn.addEventListener('click', () => {
        const rate = parseFloat(btn.dataset.rate);
        player.setPlaybackRate(rate);
      });
    });

    // å¾ªç¯æ¨¡å¼
    document.querySelectorAll('[data-loop]').forEach(btn => {
      btn.addEventListener('click', () => {
        player.setLoopMode(btn.dataset.loop);
      });
    });

    // è½¨é“å˜åŒ–
    player.on('trackchange', () => {
      renderPlaylist();
    });
  </script>
</body>

</html>